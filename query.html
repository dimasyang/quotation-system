
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>æŸ¥è©¢å ±åƒ¹</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>æŸ¥è©¢å ±åƒ¹</h2>
  <label>è¼¸å…¥é—œéµå­—ï¼ˆä¾‹å¦‚ï¼šç™½è¦ä»71/90ï¼‰ï¼š
    <input id="keyword" placeholder="ä¾‹å¦‚ï¼šç™½è¦ä»71/90" />
  </label>
  <button onclick="search()">æŸ¥è©¢</button>
  <button onclick="deleteSelected()">åˆªé™¤æ‰€é¸è³‡æ–™</button>
  <button onclick="location.href='index.html'">è¿”å›é¦–é </button>
  <button onclick="window.location.href='https://dimasyang.github.io/shrimp-sales-tool/index.html'">å‰å¾€å ±åƒ¹è¨ˆç®—å·¥å…·</button>
  <div id="result"></div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js">
    function toggleDateSort() {
      sortDescending = !sortDescending;
      search();
    }
    </script>
    
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js">
    function toggleDateSort() {
      sortDescending = !sortDescending;
      search();
    }
    </script>
    
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAYmv1mt2QV0Ex0J1PlASfZjA3bdBvIJws",
      authDomain: "haishang-a09c3.firebaseapp.com",
      projectId: "haishang-a09c3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let cacheDocs = [];
let sortDescending = true;

    function search() {
      const keyword = document.getElementById("keyword").value.trim().toLowerCase();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "æŸ¥è©¢ä¸­...";
      cacheDocs = [];

      
    db.collection("prices").get().then((querySnapshot) => {
        const docs = [];
        querySnapshot.forEach(doc => docs.push({ id: doc.id, data: doc.data() }));
        docs.sort((a, b) => {
            const da = new Date(a.data.date || "1970-01-01");
            const db = new Date(b.data.date || "1970-01-01");
            return sortDescending ? db - da : da - db;
        });
    
        let html = "<table class='price-table'><tr><th><input type='checkbox' id='selectAll' onchange='toggleAll(this)'></th><th>å“å</th><th>è¦æ ¼</th><th>åƒ¹æ ¼</th><th onclick='toggleDateSort()' style='cursor:pointer;'>æ—¥æœŸ ğŸ”½</th><th>å» å•†</th></tr>";
        docs.forEach((doc) => {
          const d = doc.data;
          const docID = doc.id;
          const combined = (d.item || "") + (d.spec || "");
          if (keyword === "" || combined.toLowerCase().includes(keyword)) {
            cacheDocs.push({ id: docID, data: d });
            html += `<tr>
              <td><input type="checkbox" value="${docID}"></td>
              <td>${d.item || ""}</td>
              <td>${d.spec || ""}</td>
              <td>${d.price || ""}</td>
              <td>${d.date || ""}</td>
              <td>${d.vendor || ""}</td>
            </tr>`;
          }
        });
        html += "</table>";
        resultDiv.innerHTML = html;
        if (cacheDocs.length === 0) {
          resultDiv.innerHTML = "âŒ æ‰¾ä¸åˆ°è³‡æ–™";
        }
      }).catch((err) => {
        resultDiv.innerHTML = "âŒ æŸ¥è©¢éŒ¯èª¤ï¼š" + err.message;
      });
    }

    function toggleAll(source) {
      document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = source.checked);
    }

    function deleteSelected() {
      const checked = Array.from(document.querySelectorAll("input[type=checkbox]:checked"));
      if (checked.length === 0) {
        alert("è«‹å…ˆå‹¾é¸è¦åˆªé™¤çš„è³‡æ–™");
        return;
      }

      if (!confirm("ç¢ºå®šè¦åˆªé™¤æ‰€é¸è³‡æ–™å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸ")) return;

      let deletes = checked.map(c => db.collection("prices").doc(c.value).delete());
      Promise.all(deletes).then(() => {
        alert("âœ… åˆªé™¤æˆåŠŸ");
        search();
      }).catch(err => {
        alert("âŒ åˆªé™¤å¤±æ•—ï¼š" + err.message);
      });
    }
  
    function toggleDateSort() {
      sortDescending = !sortDescending;
      search();
    }
    </script>
    
</body>
</html>
